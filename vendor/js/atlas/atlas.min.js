/* Atlas.js
* version: 0.0.1
* author: Brennan Nunamaker
* license: MIT
*/
(function(){window.AtlasModules=function(){function t(t){this.io=t,this.Logger={},this.Parser={},this.Atlas={}}return t}()}).call(this),function(){var t;t=function(){function t(){}return t.groupStarted=!1,t.logActive=!0,t.startAtlasGroup=function(){this.logActive&&(this.groupStarted||(console.groupCollapsed("%cAtlas Template","color: #d35400;"),this.groupStarted=!0))},t.endAtlasGroup=function(){this.logActive&&(console.groupEnd(),this.groupStarted=!1)},t.logError=function(t,e){this.logActive&&console.warn("%c"+t,"color: #e74c3c;",e)},t.logInfo=function(t,e){this.logActive&&console.log("%c"+t,"color: #3498db;",e)},t}(),"undefined"!=typeof module&&module.exports?module.exports=t:AtlasModules.Logger=t}.call(this),function(){var t,e;e="undefined"!=typeof require?require("./atl-logger"):AtlasModules.Logger,t=function(){function t(){}return t.parseStyleMap=function(t,i){var n,s,r,o,l;return s=this.getColorRules(t,i),o=this.getImageRules(t,i),r=this.getFontRules(t,i),n=[].concat.apply([],[s,o,r]),e.logInfo("Atlas Rules",n),l=this.getNodeRules(i,n),e.logInfo("Node Rules",l),n=n.concat(l),e.logInfo("Final Rules",n),n},t.getColorRules=function(t,e){var i,n,s,r,o,l;r=[],s=e.colors,o=t.colors;for(i in s)n=this.getObjVal(s,i),l=this.getObjVal(o,i),r="semantic"===i?r.concat(this.createColorRulesForSemanticClasses(n,l)):r.concat(this.createColorRulesForClasses(n,l));return r},t.getImageRules=function(t,e){var i,n;return i=this.getObjVal(e,"images"),n=this.getObjVal(t,"images"),this.createImageRules(i,n)},t.getFontRules=function(t,e){var i,n;return i=this.getObjVal(e,"fonts"),n=this.getObjVal(t,"fonts"),this.createFontRules(i,n)},t.getNodeRules=function(t,e){var i;return i=this.getObjVal(t,"nodes"),this.createNodeRules(i,e)},t.getCssRuleFromAtlasRule=function(t){var e,i;return i=t.selector,e=t.cssAttrs,this.isAtlasSelector(i)?"."+(i=this.getSelectorWithPseudoSuffix(i))+"{ "+e+" }":this.isPseudoSelector(i)?this.getCssNodeRuleWithPseudoSelector(i,e):i+"{ "+e+" }"},t.createColorRulesForClasses=function(t,e){var i,n,s,r,o,l,u,a,h,c,p;for(c=[],e=this.getSafeValue(e,this.getObjVal(t,"default")),u=t.classes,o=0,l=u.length;o<l;o++)i=u[o],s=i,h=this.getColorRuleForClassType(i),"svg"!==h?"brd"!==h?(a={selector:s,cssAttrs:h+": "+e+";"},c.push(a)):(n={selector:s,cssAttrs:"border: 1px solid "+e+";"},c.push(n)):(p={selector:s,cssAttrs:"stroke: "+e+";"},r={selector:s,cssAttrs:"fill: "+e+";"},c.push(p),c.push(r));return c},t.createColorRulesForSemanticClasses=function(t,e){var i,n,s,r;s=[];for(i in t)r=this.getSafeValue(this.getObjVal(e,i),this.getObjVal(t,i)),i="atl-"+i,n={selector:i,cssAttrs:"color: "+r+";"},s.push(n);return s},t.getColorRuleForClassType=function(t){return-1!==t.indexOf("txt")?"color":-1!==t.indexOf("bg")?"background-color":-1!==t.indexOf("brd")?"brd":-1!==t.indexOf("svg")?"svg":""},t.createImageRules=function(t,e){var i,n,s,r;s=[];for(i in t)r=this.getSafeValue(this.getImageSrc(e,i),this.getImageSrc(t,i)),i="atl-img-"+i,n={selector:i,cssAttrs:"background: url('"+r+"') no-repeat center center; background-size: cover;"},s.push(n);return s},t.createFontRules=function(t,e){var i,n,s,r;s=[];for(i in t)r=this.getSafeValue(this.getObjVal(e,i),this.getObjVal(t,i)),this.isFontPseudonym(r)&&(r=this.mapFontPseudonymToCss(r)),i="atl-font-"+i,n={selector:i,cssAttrs:"font-family: "+r+";"},s.push(n);return s},t.isFontPseudonym=function(t){return t in this.getFontPseudonymMap()},t.mapFontPseudonymToCss=function(t){var e;return e=this.getFontPseudonymMap(),!t in e?t:e[t]},t.getFontPseudonymMap=function(){return{montserrat:"'Montserrat', sans-serif","montserrat-alternates":"'Montserrat Alternates', sans-serif",roboto:"'Roboto', sans-serif",chewy:"'Chewy', cursive","averia-libre":"'Averia Libre', cursive","dancing-script":"'Dancing Script', cursive",pangolin:"'Pangolin', cursive","caesar-dressing":"'Caesar Dressing', cursive","covered-by-your-grace":"'Covered By Your Grace', cursive","indie-flower":"'Indie Flower', cursive","east-sea-dokdo":"'East Sea Dokdo', cursive","yeon-sung":"'Yeon Sung', cursive",lobster:"'Lobster', cursive","gloria-hallelujah":"'Gloria Hallelujah', cursive","amatic-sc":"'Amatic SC', cursive",cinzel:"'Cinzel', serif",gugi:"'Gugi', cursive","permanent-marker":"'Permanent Marker', cursive",arial:"'Arial', sans-serif",garamond:"'Garamond', serif",raleway:"'Raleway', sans-serif"}},t.createNodeRules=function(t,e){var i,n,s;s=[];for(n in t)i=t[n],s=s.concat(this.getMatchingAtlasRules(n,i,e));return s},t.getMatchingAtlasRules=function(t,e,i){var n,s,r,o,l,u,a,h,c;for(h=[],r=0,l=e.length;r<l;r++)for(s=e[r],o=0,u=i.length;o<u;o++)n=i[o],s===n.selector&&(c=this.getSelectorWithNodePseudoSuffix(t,s),a={selector:c,cssAttrs:n.cssAttrs},h.push(a));return h},t.getSelectorWithNodePseudoSuffix=function(t,e){return-1!==e.indexOf("hov")?t+"-hov":t},t.getSafeValue=function(t,e){return null===t||void 0===t||""===t?e:t},t.getObjVal=function(t,e){return t&&e?!t instanceof Object?"":!e in t?"":t[e]:""},t.getImageSrc=function(t,e){var i;return t&&e?!t instanceof Object?"":!e in t?"":(i=t[e],!1 in i?"":i.src):""},t.getSelectorWithPseudoSuffix=function(t){return-1!==t.indexOf("hov")?t+":hover":t},t.getCssNodeRuleWithPseudoSelector=function(t,e){return(t=t.replace("-hov",":hover"))+"{ "+e+" }"},t.isAtlasSelector=function(t){return 0===t.indexOf("atl")},t.isPseudoSelector=function(t){return-1!==t.indexOf("hov")},t}(),"undefined"!=typeof module&&module.exports?module.exports=t:AtlasModules.Parser=t}.call(this),function(){var t,e,i;e=AtlasModules.Logger,i=AtlasModules.Parser,t=function(){function t(t){e.startAtlasGroup(),this.styleSheet=this.getAtlasStylesheet(t),this.originalRules=this.getRulesCloneFromStylesheet(),this.rules=this.getRulesCloneFromStylesheet()}return t.originalRules=[],t.prototype.getRulesCloneFromStylesheet=function(){var t,i,n,s,r;if(t=[],!1 in this.styleSheet||!this.styleSheet.cssRules)return e.logError("No original stylesheet rules!",this.styleSheet),[];for(r=this.styleSheet.cssRules,n=0,s=r.length;n<s;n++)i=r[n],t.push(i);return t},t.prototype.renderCss=function(t,n){e.startAtlasGroup(),this.rollbackInjectedRules(),this.rules=i.parseStyleMap(t,n),this.injectRulesIntoStyleSheet(this.rules),e.logInfo("Stylesheets",document.styleSheets),e.endAtlasGroup()},t.prototype.getAtlasStylesheet=function(t){var i,n,s;for(i=0,n=t.length;i<n;i++)if(s=t[i],null!==s.href&&-1!==s.href.indexOf("atlas"))return e.logInfo("Stylesheet found!",s),s;e.logError("No Atlas Stylesheet detected!")},t.prototype.injectRulesIntoStyleSheet=function(t){var n,s,r,o;for(e.logInfo("Injecting Rules",t),r=0,o=t.length;r<o;r++)n=t[r],s=i.getCssRuleFromAtlasRule(n),this.styleSheet.insertRule(s,this.getLastRuleIdx());e.logInfo("Injected Stylesheet",this.styleSheet.cssRules)},t.prototype.rollbackInjectedRules=function(){this.removeAllStyleSheetRules(),this.insertOriginalStyleSheetRules()},t.prototype.removeAllStyleSheetRules=function(){if(this.styleSheet.cssRules)for(;this.styleSheet.cssRules.length>0;)this.removeStylesheetRule(0)},t.prototype.removeStylesheetRule=function(t){return"removeRule"in this.styleSheet?void this.styleSheet.removeRule(0):"deleteRule"in this.styleSheet?void this.styleSheet.deleteRule(0):void e.logError("Rule could not be removed!",this.styleSheet)},t.prototype.insertOriginalStyleSheetRules=function(){var t,i,n,s;for(e.logInfo("Inserting rules",this.originalRules),s=this.originalRules,i=0,n=s.length;i<n;i++)t=s[i],e.logInfo("Inserting rule",t),"object"==typeof t&&"cssText"in t&&t.cssText.length?this.styleSheet.insertRule(t.cssText,this.getLastRuleIdx()):this.styleSheet.insertRule(t,this.getLastRuleIdx())},t.prototype.getLastRuleIdx=function(){return this.styleSheet.cssRules?this.styleSheet.cssRules.length:0},t}(),AtlasModules.Atlas=t}.call(this),function(){$(document).ready(function(){var t;window.atlas=new AtlasModules.Atlas(document.styleSheets),window.atlas.renderCss(styles,styleMapJson),t=document.getElementsByTagName("html")[0],rivets.bind(t,pageData),"function"==typeof window.parent.injectStyles&&window.parent.injectStyles()})}.call(this),function(){function t(t,i,n,s){return new e(t,i,n,s)}function e(t,e,n,s){this.options=s||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=e,this.callback=n,this.objectPath=[],this.update=this.update.bind(this),this.parse(),i(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function i(t){return"object"==typeof t&&null!==t}function n(t){throw new Error("[sightglass] "+t)}t.adapters={},e.tokenize=function(t,e,i){var n,s,r=[],o={i:i,path:""};for(n=0;n<t.length;n++)s=t.charAt(n),~e.indexOf(s)?(r.push(o),o={i:s,path:""}):o.path+=s;return r.push(o),r},e.prototype.parse=function(){var i,s,r=this.interfaces();r.length||n("Must define at least one adapter interface."),~r.indexOf(this.keypath[0])?(i=this.keypath[0],s=this.keypath.substr(1)):(void 0===(i=this.options.root||t.root)&&n("Must define a default root adapter."),s=this.keypath),this.tokens=e.tokenize(s,r,i),this.key=this.tokens.pop()},e.prototype.realize=function(){var t,e=this.obj,n=!1;return this.tokens.forEach(function(s,r){i(e)?(void 0!==this.objectPath[r]?e!==(t=this.objectPath[r])&&(this.set(!1,s,t,this.update),this.set(!0,s,e,this.update),this.objectPath[r]=e):(this.set(!0,s,e,this.update),this.objectPath[r]=e),e=this.get(s,e)):(!1===n&&(n=r),(t=this.objectPath[r])&&this.set(!1,s,t,this.update))},this),!1!==n&&this.objectPath.splice(n),e},e.prototype.update=function(){var t,e;(t=this.realize())!==this.target&&(i(this.target)&&this.set(!1,this.key,this.target,this.callback),i(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,(this.value()instanceof Function||this.value()!==e)&&this.callback())},e.prototype.value=function(){return i(this.target)?this.get(this.key,this.target):void 0},e.prototype.setValue=function(t){i(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},e.prototype.get=function(t,e){return this.adapter(t).get(e,t.path)},e.prototype.set=function(t,e,i,n){var s=t?"observe":"unobserve";this.adapter(e)[s](i,e.path,n)},e.prototype.interfaces=function(){var e=Object.keys(this.options.adapters);return Object.keys(t.adapters).forEach(function(t){~e.indexOf(t)||e.push(t)}),e},e.prototype.adapter=function(e){return this.options.adapters[e.i]||t.adapters[e.i]},e.prototype.unobserve=function(){var t;this.tokens.forEach(function(e,i){(t=this.objectPath[i])&&this.set(!1,e,t,this.update)},this),i(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define([],function(){return this.sightglass=t}):this.sightglass=t}.call(this),function(){var t,e,i,n,s,r=function(t,e){return function(){return t.apply(e,arguments)}},o=[].slice,l={}.hasOwnProperty,u=function(t,e){function i(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};t={options:["prefix","templateDelimiters","rootInterface","preloadData","handler","executeFunctions"],extensions:["binders","formatters","components","adapters"],public:{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,executeFunctions:!1,iterationAlias:function(t){return"%"+t+"%"},handler:function(t,e,i){return this.call(t,e,i.view.models)},configure:function(e){var i,n,s,r;null==e&&(e={});for(s in e)if(r=e[s],"binders"===s||"components"===s||"formatters"===s||"adapters"===s)for(n in r)i=r[n],t[s][n]=i;else t.public[s]=r},bind:function(e,i,n){var s;return null==i&&(i={}),null==n&&(n={}),s=new t.View(e,i,n),s.bind(),s},init:function(e,i,n){var s,r,o;if(null==n&&(n={}),null==i&&(i=document.createElement("div")),e=t.public.components[e],(r=e.template.call(this,i))instanceof HTMLElement){for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(r)}else i.innerHTML=r;return s=e.initialize.call(this,i,n),o=new t.View(i,s),o.bind(),o}}},window.jQuery||window.$?(i=window.jQuery||window.$,s="on"in i.prototype?["on","off"]:["bind","unbind"],e=s[0],n=s[1],t.Util={bindEvent:function(t,n,s){return i(t)[e](n,s)},unbindEvent:function(t,e,s){return i(t)[n](e,s)},getInputValue:function(t){var e;return e=i(t),"checkbox"===e.attr("type")?e.is(":checked"):e.val()}}):t.Util={bindEvent:function(){return"addEventListener"in window?function(t,e,i){return t.addEventListener(e,i,!1)}:function(t,e,i){return t.attachEvent("on"+e,i)}}(),unbindEvent:function(){return"removeEventListener"in window?function(t,e,i){return t.removeEventListener(e,i,!1)}:function(t,e,i){return t.detachEvent("on"+e,i)}}(),getInputValue:function(t){var e,i,n,s;if("checkbox"===t.type)return t.checked;if("select-multiple"===t.type){for(s=[],i=0,n=t.length;n>i;i++)e=t[i],e.selected&&s.push(e.value);return s}return t.value}},t.TypeParser=function(){function t(){}return t.types={primitive:0,keypath:1},t.parse=function(t){return/^'.*'$|^".*"$/.test(t)?{type:this.types.primitive,value:t.slice(1,-1)}:"true"===t?{type:this.types.primitive,value:!0}:"false"===t?{type:this.types.primitive,value:!1}:"null"===t?{type:this.types.primitive,value:null}:"undefined"===t?{type:this.types.primitive,value:void 0}:""===t?{type:this.types.primitive,value:void 0}:!1===isNaN(Number(t))?{type:this.types.primitive,value:Number(t)}:{type:this.types.keypath,value:t}},t}(),t.TextTemplateParser=function(){function t(){}return t.types={text:0,binding:1},t.parse=function(t,e){var i,n,s,r,o,l,u;for(l=[],r=t.length,i=0,n=0;r>n;){if(0>(i=t.indexOf(e[0],n))){l.push({type:this.types.text,value:t.slice(n)});break}if(i>0&&i>n&&l.push({type:this.types.text,value:t.slice(n,i)}),n=i+e[0].length,0>(i=t.indexOf(e[1],n))){o=t.slice(n-e[1].length),s=l[l.length-1],(null!=s?s.type:void 0)===this.types.text?s.value+=o:l.push({type:this.types.text,value:o});break}u=t.slice(n,i).trim(),l.push({type:this.types.binding,value:u}),n=i+e[1].length}return l},t}(),t.View=function(){function e(e,i,n){var s,o,l,u,a,h,c,p,d,f,v,b,g;for(this.els=e,this.models=i,null==n&&(n={}),this.update=r(this.update,this),this.publish=r(this.publish,this),this.sync=r(this.sync,this),this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.select=r(this.select,this),this.traverse=r(this.traverse,this),this.build=r(this.build,this),this.buildBinding=r(this.buildBinding,this),this.bindingRegExp=r(this.bindingRegExp,this),this.options=r(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),d=t.extensions,a=0,c=d.length;c>a;a++){if(o=d[a],this[o]={},n[o]){f=n[o];for(s in f)l=f[s],this[o][s]=l}v=t.public[o];for(s in v)l=v[s],null==(u=this[o])[s]&&(u[s]=l)}for(b=t.options,h=0,p=b.length;p>h;h++)o=b[h],this[o]=null!=(g=n[o])?g:t.public[o];this.build()}return e.prototype.options=function(){var e,i,n,s,r;for(i={},r=t.extensions.concat(t.options),n=0,s=r.length;s>n;n++)e=r[n],i[e]=this[e];return i},e.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},e.prototype.buildBinding=function(e,i,n,s){var r,o,l,u,a,h,c;return a={},c=function(){var t,e,i,n;for(i=s.match(/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g),n=[],t=0,e=i.length;e>t;t++)h=i[t],n.push(h.trim());return n}(),r=function(){var t,e,i,n;for(i=c.shift().split("<"),n=[],t=0,e=i.length;e>t;t++)o=i[t],n.push(o.trim());return n}(),u=r.shift(),a.formatters=c,(l=r.shift())&&(a.dependencies=l.split(/\s+/)),this.bindings.push(new t[e](this,i,n,u,a))},e.prototype.build=function(){var e,i,n,s,r;for(this.bindings=[],i=function(e){return function(n){var s,r,o,l,u,a,h,c,p,d,f,v,b;if(3===n.nodeType){if(u=t.TextTemplateParser,(o=e.templateDelimiters)&&(c=u.parse(n.data,o)).length&&(1!==c.length||c[0].type!==u.types.text)){for(p=0,f=c.length;f>p;p++)h=c[p],a=document.createTextNode(h.value),n.parentNode.insertBefore(a,n),1===h.type&&e.buildBinding("TextBinding",a,null,h.value);n.parentNode.removeChild(n)}}else 1===n.nodeType&&(s=e.traverse(n));if(!s)for(b=function(){var t,e,i,s;for(i=n.childNodes,s=[],t=0,e=i.length;e>t;t++)l=i[t],s.push(l);return s}(),d=0,v=b.length;v>d;d++)r=b[d],i(r)}}(this),r=this.els,n=0,s=r.length;s>n;n++)e=r[n],i(e);this.bindings.sort(function(t,e){var i,n;return((null!=(i=e.binder)?i.priority:void 0)||0)-((null!=(n=t.binder)?n.priority:void 0)||0)})},e.prototype.traverse=function(e){var i,n,s,r,o,l,u,a,h,c,p,d,f,v,b,g;for(r=this.bindingRegExp(),o="SCRIPT"===e.nodeName||"STYLE"===e.nodeName,v=e.attributes,c=0,d=v.length;d>c;c++)if(i=v[c],r.test(i.name)){if(a=i.name.replace(r,""),!(s=this.binders[a])){b=this.binders;for(l in b)h=b[l],"*"!==l&&-1!==l.indexOf("*")&&(u=new RegExp("^"+l.replace(/\*/g,".+")+"$"),u.test(a)&&(s=h))}s||(s=this.binders["*"]),s.block&&(o=!0,n=[i])}for(g=n||e.attributes,p=0,f=g.length;f>p;p++)i=g[p],r.test(i.name)&&(a=i.name.replace(r,""),this.buildBinding("Binding",e,a,i.value));return o||(a=e.nodeName.toLowerCase(),this.components[a]&&!e._bound&&(this.bindings.push(new t.ComponentBinding(this,e,a)),o=!0)),o},e.prototype.select=function(t){var e,i,n,s,r;for(s=this.bindings,r=[],i=0,n=s.length;n>i;i++)e=s[i],t(e)&&r.push(e);return r},e.prototype.bind=function(){var t,e,i,n;for(n=this.bindings,e=0,i=n.length;i>e;e++)t=n[e],t.bind()},e.prototype.unbind=function(){var t,e,i,n;for(n=this.bindings,e=0,i=n.length;i>e;e++)t=n[e],t.unbind()},e.prototype.sync=function(){var t,e,i,n;for(n=this.bindings,e=0,i=n.length;i>e;e++)t=n[e],"function"==typeof t.sync&&t.sync()},e.prototype.publish=function(){var t,e,i,n;for(n=this.select(function(t){var e;return null!=(e=t.binder)?e.publishes:void 0}),e=0,i=n.length;i>e;e++)t=n[e],t.publish()},e.prototype.update=function(t){var e,i,n,s,r,o;null==t&&(t={});for(i in t)n=t[i],this.models[i]=n;for(o=this.bindings,s=0,r=o.length;r>s;s++)e=o[s],"function"==typeof e.update&&e.update(t)},e}(),t.Binding=function(){function e(t,e,i,n,s){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=s?s:{},this.getValue=r(this.getValue,this),this.update=r(this.update,this),this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.publish=r(this.publish,this),this.sync=r(this.sync,this),this.set=r(this.set,this),this.eventHandler=r(this.eventHandler,this),this.formattedValue=r(this.formattedValue,this),this.parseFormatterArguments=r(this.parseFormatterArguments,this),this.parseTarget=r(this.parseTarget,this),this.observe=r(this.observe,this),this.setBinder=r(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return e.prototype.setBinder=function(){var t,e,i,n;if(!(this.binder=this.view.binders[this.type])){n=this.view.binders;for(t in n)i=n[t],"*"!==t&&-1!==t.indexOf("*")&&(e=new RegExp("^"+t.replace(/\*/g,".+")+"$"),e.test(this.type)&&(this.binder=i,this.args=new RegExp("^"+t.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},e.prototype.observe=function(e,i,n){return t.sightglass(e,i,n,{root:this.view.rootInterface,adapters:this.view.adapters})},e.prototype.parseTarget=function(){var e;return e=t.TypeParser.parse(this.keypath),e.type===t.TypeParser.types.primitive?this.value=e.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},e.prototype.parseFormatterArguments=function(e,i){var n,s,r,o,l,u,a;for(e=function(){var i,n,r;for(r=[],i=0,n=e.length;n>i;i++)s=e[i],r.push(t.TypeParser.parse(s));return r}(),o=[],n=u=0,a=e.length;a>u;n=++u)s=e[n],o.push(s.type===t.TypeParser.types.primitive?s.value:((l=this.formatterObservers)[i]||(l[i]={}),(r=this.formatterObservers[i][n])||(r=this.observe(this.view.models,s.value,this.sync),this.formatterObservers[i][n]=r),r.value()));return o},e.prototype.formattedValue=function(t){var e,i,n,s,r,l,u,a,h;for(a=this.formatters,i=l=0,u=a.length;u>l;i=++l)n=a[i],e=n.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),s=e.shift(),n=this.view.formatters[s],r=this.parseFormatterArguments(e,i),(null!=n?n.read:void 0)instanceof Function?t=(h=n.read).call.apply(h,[this.model,t].concat(o.call(r))):n instanceof Function&&(t=n.call.apply(n,[this.model,t].concat(o.call(r))));return t},e.prototype.eventHandler=function(t){var e,i;return i=(e=this).view.handler,function(n){return i.call(t,this,n,e)}},e.prototype.set=function(e){var i;return e=e instanceof Function&&!this.binder.function&&t.public.executeFunctions?this.formattedValue(e.call(this.model)):this.formattedValue(e),null!=(i=this.binder.routine)?i.call(this,this.el,e):void 0},e.prototype.sync=function(){var t,e;return this.set(function(){var i,n,s,r,o,l,u;if(this.observer){if(this.model!==this.observer.target){for(o=this.dependencies,i=0,s=o.length;s>i;i++)e=o[i],e.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(l=this.options.dependencies)?l.length:void 0))for(u=this.options.dependencies,n=0,r=u.length;r>n;n++)t=u[n],e=this.observe(this.model,t,this.sync),this.dependencies.push(e)}return this.observer.value()}return this.value}.call(this))},e.prototype.publish=function(){var t,e,i,n,s,r,l,u,a,h,c,p,d;if(this.observer){for(u=this.getValue(this.el),r=this.formatters.length-1,c=this.formatters.slice(0).reverse(),i=a=0,h=c.length;h>a;i=++a)n=c[i],e=r-i,t=n.split(/\s+/),s=t.shift(),l=this.parseFormatterArguments(t,e),(null!=(p=this.view.formatters[s])?p.publish:void 0)&&(u=(d=this.view.formatters[s]).publish.apply(d,[u].concat(o.call(l))));return this.observer.setValue(u)}},e.prototype.bind=function(){var t,e,i,n,s,r,o;if(this.parseTarget(),null!=(s=this.binder.bind)&&s.call(this,this.el),null!=this.model&&(null!=(r=this.options.dependencies)?r.length:void 0))for(o=this.options.dependencies,i=0,n=o.length;n>i;i++)t=o[i],e=this.observe(this.model,t,this.sync),this.dependencies.push(e);return this.view.preloadData?this.sync():void 0},e.prototype.unbind=function(){var t,e,i,n,s,r,o,l,u,a;for(null!=(o=this.binder.unbind)&&o.call(this,this.el),null!=(l=this.observer)&&l.unobserve(),u=this.dependencies,s=0,r=u.length;r>s;s++)n=u[s],n.unobserve();this.dependencies=[],a=this.formatterObservers;for(i in a){e=a[i];for(t in e)n=e[t],n.unobserve()}return this.formatterObservers={}},e.prototype.update=function(t){var e,i;return null==t&&(t={}),this.model=null!=(e=this.observer)?e.target:void 0,null!=(i=this.binder.update)?i.call(this,t):void 0},e.prototype.getValue=function(e){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,e):t.Util.getInputValue(e)},e}(),t.ComponentBinding=function(e){function i(e,i,n){var s,o,l,u,h,c,p,d;for(this.view=e,this.el=i,this.type=n,this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.locals=r(this.locals,this),this.component=this.view.components[this.type],this.static={},this.observers={},this.upstreamObservers={},o=e.bindingRegExp(),p=this.el.attributes||[],h=0,c=p.length;c>h;h++)s=p[h],o.test(s.name)||(l=this.camelCase(s.name),u=t.TypeParser.parse(s.value),a.call(null!=(d=this.component.static)?d:[],l)>=0?this.static[l]=s.value:u.type===t.TypeParser.types.primitive?this.static[l]=u.value:this.observers[l]=s.value)}return u(i,e),i.prototype.sync=function(){},i.prototype.update=function(){},i.prototype.publish=function(){},i.prototype.locals=function(){var t,e,i,n,s,r;i={},s=this.static;for(t in s)n=s[t],i[t]=n;r=this.observers;for(t in r)e=r[t],i[t]=e.value();return i},i.prototype.camelCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},i.prototype.bind=function(){var e,i,n,s,r,o,l,u,a,h,c,p,d,f,v,b,g,y,m,w;if(!this.bound){f=this.observers;for(i in f)n=f[i],this.observers[i]=this.observe(this.view.models,n,function(t){return function(e){return function(){return t.componentView.models[e]=t.observers[e].value()}}}(this).call(this,i));this.bound=!0}if(null!=this.componentView)this.componentView.bind();else{for(this.el.innerHTML=this.component.template.call(this),l=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,o={},v=t.extensions,h=0,p=v.length;p>h;h++){if(r=v[h],o[r]={},this.component[r]){b=this.component[r];for(e in b)u=b[e],o[r][e]=u}g=this.view[r];for(e in g)u=g[e],null==(a=o[r])[e]&&(a[e]=u)}for(y=t.options,c=0,d=y.length;d>c;c++)r=y[c],o[r]=null!=(m=this.component[r])?m:this.view[r];this.componentView=new t.View(Array.prototype.slice.call(this.el.childNodes),l,o),this.componentView.bind(),w=this.observers;for(i in w)s=w[i],this.upstreamObservers[i]=this.observe(this.componentView.models,i,function(t){return function(e,i){return function(){return i.setValue(t.componentView.models[e])}}}(this).call(this,i,s))}},i.prototype.unbind=function(){var t,e,i,n,s;i=this.upstreamObservers;for(t in i)e=i[t],e.unobserve();n=this.observers;for(t in n)e=n[t],e.unobserve();return null!=(s=this.componentView)?s.unbind.call(this):void 0},i}(t.Binding),t.TextBinding=function(t){function e(t,e,i,n,s){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=s?s:{},this.sync=r(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return u(e,t),e.prototype.binder={routine:function(t,e){return t.data=null!=e?e:""}},e.prototype.sync=function(){return e.__super__.sync.apply(this,arguments)},e}(t.Binding),t.public.binders.text=function(t,e){return null!=t.textContent?t.textContent=null!=e?e:"":t.innerText=null!=e?e:""},t.public.binders.html=function(t,e){return t.innerHTML=null!=e?e:""},t.public.binders.show=function(t,e){return t.style.display=e?"":"none"},t.public.binders.hide=function(t,e){return t.style.display=e?"none":""},t.public.binders.enabled=function(t,e){return t.disabled=!e},t.public.binders.disabled=function(t,e){return t.disabled=!!e},t.public.binders.checked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var i;return t.checked="radio"===t.type?(null!=(i=t.value)?i.toString():void 0)===(null!=e?e.toString():void 0):!!e}},t.public.binders.unchecked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var i;return t.checked="radio"===t.type?(null!=(i=t.value)?i.toString():void 0)!==(null!=e?e.toString():void 0):!e}},t.public.binders.value={publishes:!0,priority:3e3,bind:function(e){return"INPUT"!==e.tagName||"radio"!==e.type?(this.event="SELECT"===e.tagName?"change":"input",t.Util.bindEvent(e,this.event,this.publish)):void 0},unbind:function(e){return"INPUT"!==e.tagName||"radio"!==e.type?t.Util.unbindEvent(e,this.event,this.publish):void 0},routine:function(t,e){var n,s,r,o,l,u,h;if("INPUT"===t.tagName&&"radio"===t.type)return t.setAttribute("value",e);if(null!=window.jQuery){if(t=i(t),(null!=e?e.toString():void 0)!==(null!=(o=t.val())?o.toString():void 0))return t.val(null!=e?e:"")}else if("select-multiple"===t.type){if(null!=e){for(h=[],s=0,r=t.length;r>s;s++)n=t[s],h.push(n.selected=(l=n.value,a.call(e,l)>=0));return h}}else if((null!=e?e.toString():void 0)!==(null!=(u=t.value)?u.toString():void 0))return t.value=null!=e?e:""}},t.public.binders.if={block:!0,priority:4e3,bind:function(t){var e,i;return null==this.marker?(e=[this.view.prefix,this.type].join("-").replace("--","-"),i=t.getAttribute(e),this.marker=document.createComment(" rivets: "+this.type+" "+i+" "),this.bound=!1,t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)):void 0},unbind:function(){return this.nested?(this.nested.unbind(),this.bound=!1):void 0},routine:function(e,i){var n,s,r,o;if(!!i==!this.bound){if(i){r={},o=this.view.models;for(n in o)s=o[n],r[n]=s;return(this.nested||(this.nested=new t.View(e,r,this.view.options()))).bind(),this.marker.parentNode.insertBefore(e,this.marker.nextSibling),this.bound=!0}return e.parentNode.removeChild(e),this.nested.unbind(),this.bound=!1}},update:function(t){var e;return null!=(e=this.nested)?e.update(t):void 0}},t.public.binders.unless={block:!0,priority:4e3,bind:function(e){return t.public.binders.if.bind.call(this,e)},unbind:function(){return t.public.binders.if.unbind.call(this)},routine:function(e,i){return t.public.binders.if.routine.call(this,e,!i)},update:function(e){return t.public.binders.if.update.call(this,e)}},t.public.binders["on-*"]={function:!0,priority:1e3,unbind:function(e){return this.handler?t.Util.unbindEvent(e,this.args[0],this.handler):void 0},routine:function(e,i){return this.handler&&t.Util.unbindEvent(e,this.args[0],this.handler),t.Util.bindEvent(e,this.args[0],this.handler=this.eventHandler(i))}},t.public.binders["each-*"]={block:!0,priority:4e3,bind:function(t){var e,i,n,s,r;if(null==this.marker)e=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t);else for(r=this.iterated,n=0,s=r.length;s>n;n++)i=r[n],i.bind()},unbind:function(){var t,e,i,n;if(null!=this.iterated)for(n=this.iterated,e=0,i=n.length;i>e;e++)t=n[e],t.unbind()},routine:function(e,i){var n,s,r,o,l,u,a,h,c,p,d,f,v,b,g,y,m,w,k;if(u=this.args[0],i=i||[],this.iterated.length>i.length)for(m=Array(this.iterated.length-i.length),d=0,b=m.length;b>d;d++)m[d],p=this.iterated.pop(),p.unbind(),this.marker.parentNode.removeChild(p.els[0]);for(r=f=0,g=i.length;g>f;r=++f)if(l=i[r],s={index:r},s[t.public.iterationAlias(u)]=r,s[u]=l,null==this.iterated[r]){w=this.view.models;for(o in w)l=w[o],null==s[o]&&(s[o]=l);h=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,a=this.view.options(),a.preloadData=!0,c=e.cloneNode(!0),p=new t.View(c,s,a),p.bind(),this.iterated.push(p),this.marker.parentNode.insertBefore(c,h.nextSibling)}else this.iterated[r].models[u]!==l&&this.iterated[r].update(s);if("OPTION"===e.nodeName)for(k=this.view.bindings,v=0,y=k.length;y>v;v++)n=k[v],n.el===this.marker.parentNode&&"value"===n.type&&n.sync()},update:function(t){var e,i,n,s,r,o,l;e={};for(i in t)n=t[i],i!==this.args[0]&&(e[i]=n);for(l=this.iterated,r=0,o=l.length;o>r;r++)s=l[r],s.update(e)}},t.public.binders["class-*"]=function(t,e){var i;return i=" "+t.className+" ",!e==(-1!==i.indexOf(" "+this.args[0]+" "))?t.className=e?t.className+" "+this.args[0]:i.replace(" "+this.args[0]+" "," ").trim():void 0},t.public.binders["*"]=function(t,e){return null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},t.public.formatters.call=function(){var t,e;return e=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],e.call.apply(e,[this].concat(o.call(t)))},t.public.adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(t){var e,i,n;return t.hasOwnProperty(this.id)||(e=this.counter++,Object.defineProperty(t,this.id,{value:e})),(i=this.weakmap)[n=t[this.id]]||(i[n]={callbacks:{}})},cleanupWeakReference:function(t,e){return Object.keys(t.callbacks).length||t.pointers&&Object.keys(t.pointers).length?void 0:delete this.weakmap[e]},stubFunction:function(t,e){var i,n,s;return n=t[e],i=this.weakReference(t),s=this.weakmap,t[e]=function(){var e,r,o,l,u,a,h,c,p;o=n.apply(t,arguments),a=i.pointers;for(r in a)for(e=a[r],p=null!=(h=null!=(c=s[r])?c.callbacks[e]:void 0)?h:[],l=0,u=p.length;u>l;l++)(0,p[l])();return o}},observeMutations:function(t,e,i){var n,s,r,o,l,u;if(Array.isArray(t)){if(r=this.weakReference(t),null==r.pointers)for(r.pointers={},s=["push","pop","shift","unshift","sort","reverse","splice"],l=0,u=s.length;u>l;l++)n=s[l],this.stubFunction(t,n);if(null==(o=r.pointers)[e]&&(o[e]=[]),a.call(r.pointers[e],i)<0)return r.pointers[e].push(i)}},unobserveMutations:function(t,e,i){var n,s,r
;return Array.isArray(t)&&null!=t[this.id]&&(s=this.weakmap[t[this.id]])&&(r=s.pointers[e])?((n=r.indexOf(i))>=0&&r.splice(n,1),r.length||delete s.pointers[e],this.cleanupWeakReference(s,t[this.id])):void 0},observe:function(t,e,i){var n,s,r;return n=this.weakReference(t).callbacks,null==n[e]&&(n[e]=[],s=Object.getOwnPropertyDescriptor(t,e),(null!=s?s.get:void 0)||(null!=s?s.set:void 0)||(r=t[e],Object.defineProperty(t,e,{enumerable:!0,get:function(){return r},set:function(i){return function(s){var o,l,u,h,c;if(s!==r&&(i.unobserveMutations(r,t[i.id],e),r=s,l=i.weakmap[t[i.id]])){if(n=l.callbacks,n[e])for(c=n[e].slice(),u=0,h=c.length;h>u;u++)o=c[u],a.call(n[e],o)>=0&&o();return i.observeMutations(s,t[i.id],e)}}}(this)}))),a.call(n[e],i)<0&&n[e].push(i),this.observeMutations(t[e],t[this.id],e)},unobserve:function(t,e,i){var n,s,r;return(r=this.weakmap[t[this.id]])&&(n=r.callbacks[e])?((s=n.indexOf(i))>=0&&(n.splice(s,1),n.length||(delete r.callbacks[e],this.unobserveMutations(t[e],t[this.id],e))),this.cleanupWeakReference(r,t[this.id])):void 0},get:function(t,e){return t[e]},set:function(t,e,i){return t[e]=i}},t.factory=function(e){return t.sightglass=e,t.public._=t,t.public},"object"==typeof("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=t.factory(require("sightglass")):"function"==typeof define&&define.amd?define(["sightglass"],function(e){return this.rivets=t.factory(e)}):this.rivets=t.factory(sightglass)}.call(this),rivets.formatters.hrefId=function(t){return"#"+t},rivets.formatters.hrefEmail=function(t){return"mailto:"+t},rivets.formatters.hrefTel=function(t){return"tel:"+t},rivets.formatters.hrefHttp=function(t){return/^http\:\/\/*/i.test(t)?t:"http://"+t},rivets.formatters.getIterableObjects=function(t,e){for(var i=[],n=0;n<t.length;n++){var s=t[n];i.push(e[s])}return i};